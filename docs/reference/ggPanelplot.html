<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Create a tmod panel plot using ggplot"><title>Create a tmod panel plot using ggplot — ggPanelplot • tmod</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a tmod panel plot using ggplot — ggPanelplot"><meta property="og:description" content="Create a tmod panel plot using ggplot"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tmod</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.50.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/tmod.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create a tmod panel plot using ggplot</h1>
      
      <div class="d-none name"><code>ggPanelplot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a tmod panel plot using ggplot</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ggPanelplot</span><span class="op">(</span></span>
<span>  <span class="va">res</span>,</span>
<span>  sgenes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  auc_thr <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  q_thr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  filter_row_q <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  filter_row_auc <span class="op">=</span> <span class="fl">0.65</span>,</span>
<span>  q_cutoff <span class="op">=</span> <span class="fl">1e-12</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  id_order <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"grey"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>  label_angle <span class="op">=</span> <span class="fl">45</span>,</span>
<span>  add_ids <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mset <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>res</dt>
<dd><p>a list with tmod results (each element of the list is a data
frame returned by a tmod test function)</p></dd>


<dt>sgenes</dt>
<dd><p>a list with summaries of significantly DE genes by gene set.
Each a element of the list is a matrix returned by tmodDecideTests. If
NULL, the bars on the plot will be monochromatic.</p></dd>


<dt>auc_thr</dt>
<dd><p>gene sets enrichments with AUC (or other effect size) below `auc_thr` will not be shown</p></dd>


<dt>q_thr</dt>
<dd><p>gene sets enrichments with q (adjusted P value) above `q_thr` will not be shown</p></dd>


<dt>filter_row_q</dt>
<dd><p>Gene sets will only be shown if at least in one
contrast q is smaller than `filter_row_q`</p></dd>


<dt>filter_row_auc</dt>
<dd><p>Gene sets will only be shown if at least in one
contrast AUC (or other effect size if specified) is larger than `filter_row_auc`</p></dd>


<dt>q_cutoff</dt>
<dd><p>Any q value below `q_cutoff` will be considered equal to
`q_cutoff`</p></dd>


<dt>cluster</dt>
<dd><p>whether to cluster the IDs by similarity</p></dd>


<dt>id_order</dt>
<dd><p>character vector specifying the order of IDs to be
shown. This needs not to contain all IDs shown, but whatever IDs are in this
vector, they will be shown on top in the given order.</p></dd>


<dt>effect_size</dt>
<dd><p>name of the column which contains the effect sizes;
by default, the name of this column is taken from the "effect_size"
attribute of the first result table.</p></dd>


<dt>colors</dt>
<dd><p>character vector with at least 1 (when sgenes is NULL) or 3
(when sgenes is not NULL) elements</p></dd>


<dt>label_angle</dt>
<dd><p>The angle at which column labels are shown</p></dd>


<dt>add_ids</dt>
<dd><p>add IDs of gene sets to their titles on the plot</p></dd>


<dt>mset</dt>
<dd><p>an object of the type 'tmodGS'. If the option `cluster` is
TRUE, the mset object is used to cluster the gene sets. By default, the
built-in transcription modules are used. See details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The object returned is a ggplot2 object which can be further
        modified the usual way.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Panel plot is a kind of a heatmap. This is the most compact way of
representing the results of several gene set enrichment analyses. Each row of a
panel plot shows the result for one gene set, and each column shows
corresponds to one analysis. For example, if one tests gene set enrichment
for a number of different contrasts, then each contrast will be represented
in a separate column.</p>
<p>Each cell of a panel plot shows both the effect size and the p-value.
The p-value is encoded as transparency: the enrichments with a lower
p-value have stronger colors. The size of the bar corresponds to the effect
size, however it is defined. For example, in case of the tmodCERNOtest,
tmodZtest or tmodUtest it is the area under curve, AUC.</p>
<p>In addition, the bars may also encode information about the number of
up- or down-regulated genes. For this, an object must be created using the
function tmodDecideTests. This object provides  information about which
genes in a particular gene set are regulated in which direction.</p>
<p>The order of the gene sets displayed is, by default, determined by
clustering the gene sets based on their overlaps. For this to work,
ggPanelplot must know about what genes are contained in which gene sets.
This is provided by the parameter `mset`. By default (when mset is NULL)
this is the built-in list of gene sets. If, however, the results of gene
set enrichment come from a different set of gene sets, you need to specify
it with the mset parameter. See Examples.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>[tmodDecideTests()], [tmodPanelPlot()]</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## prepare a set of results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Egambia</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="va">Egambia</span><span class="op">$</span><span class="va">GENE_SYMBOL</span></span></span>
<span class="r-in"><span><span class="va">exprs</span> <span class="op">&lt;-</span> <span class="va">Egambia</span><span class="op">[</span> , <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="fl">4</span> <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exprs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## test differential expression using limma</span></span></span>
<span class="r-in"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Intercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span><span class="op">)</span>, TB<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, each<span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioinf.wehi.edu.au/limma" class="external-link">limma</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">eBayes</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">lmFit</a></span><span class="op">(</span><span class="va">Egambia</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="va">design</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html" class="external-link">topTable</a></span><span class="op">(</span><span class="va">fit</span>, coef<span class="op">=</span><span class="fl">2</span>, number<span class="op">=</span><span class="cn">Inf</span>, genelist<span class="op">=</span><span class="va">Egambia</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="tmodUtest.html">tmodCERNOtest</a></span><span class="op">(</span><span class="va">tt</span><span class="op">$</span><span class="va">GENE_SYMBOL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## show the results using a panel plot</span></span></span>
<span class="r-in"><span><span class="fu">ggPanelplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>limma<span class="op">=</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## add information about the significant genes</span></span></span>
<span class="r-in"><span><span class="va">sgenes</span> <span class="op">&lt;-</span> <span class="fu"><a href="tmodDecideTests.html">tmodDecideTests</a></span><span class="op">(</span><span class="va">tt</span><span class="op">$</span><span class="va">GENE_SYMBOL</span>, lfc<span class="op">=</span><span class="va">tt</span><span class="op">$</span><span class="va">logFC</span>, pval<span class="op">=</span><span class="va">tt</span><span class="op">$</span><span class="va">adj.P.Val</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sgenes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"limma"</span></span></span>
<span class="r-in"><span><span class="fu">ggPanelplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>limma<span class="op">=</span><span class="va">res</span><span class="op">)</span>, sgenes<span class="op">=</span><span class="va">sgenes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## we will now compare the results of enrichments for different types of</span></span></span>
<span class="r-in"><span><span class="co">## differential expression tests on the data</span></span></span>
<span class="r-in"><span><span class="va">res_utest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">exprs</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">group</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_ttest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">exprs</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">group</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Calculate the gene set enrichment analysis results for each of the</span></span></span>
<span class="r-in"><span><span class="co">## different types of tests</span></span></span>
<span class="r-in"><span><span class="va">res_tmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_tmod</span><span class="op">$</span><span class="va">limma</span> <span class="op">&lt;-</span> <span class="va">res</span></span></span>
<span class="r-in"><span><span class="va">res_tmod</span><span class="op">$</span><span class="va">utest</span> <span class="op">&lt;-</span> <span class="fu"><a href="tmodUtest.html">tmodCERNOtest</a></span><span class="op">(</span><span class="va">genes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">res_utest</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_tmod</span><span class="op">$</span><span class="va">ttest</span> <span class="op">&lt;-</span> <span class="fu"><a href="tmodUtest.html">tmodCERNOtest</a></span><span class="op">(</span><span class="va">genes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">res_ttest</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">ggPanelplot</span><span class="op">(</span><span class="va">res_tmod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Using the `mset` parameter</span></span></span>
<span class="r-in"><span><span class="co">## First, we generate results using a different set of gene sets</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cell_signatures</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="tmodUtest.html">tmodCERNOtest</a></span><span class="op">(</span><span class="va">tt</span><span class="op">$</span><span class="va">GENE_SYMBOL</span>, mset<span class="op">=</span><span class="va">cell_signatures</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## the following will triger a warning that no clustering is possible</span></span></span>
<span class="r-in"><span><span class="co">## because ggPanelplot doesn't have the information about the gene set</span></span></span>
<span class="r-in"><span><span class="co">## contents</span></span></span>
<span class="r-in"><span><span class="fu">ggPanelplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>res<span class="op">=</span><span class="va">res_cs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## if we use the mset parameter, clustering is available</span></span></span>
<span class="r-in"><span><span class="fu">ggPanelplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>res<span class="op">=</span><span class="va">res_cs</span><span class="op">)</span>, mset<span class="op">=</span><span class="va">cell_signatures</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by January Weiner.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

